<html lang="en">
 <head>
  <meta charset="utf-8"/>
  <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
  <title>
   ParuAI - Lung Cancer Detection
  </title>
  <script src="https://cdn.tailwindcss.com">
  </script>
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11">
  </script>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&amp;display=swap" rel="stylesheet"/>
  <link rel="icon" type="image/png" href="https://github.com/user-attachments/assets/fd4904ce-9687-47b6-9b51-91b92b2ae4a0"/>
  <style>
   body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #f0f4f8 0%, #e6f1e6 100%);
        }
        .gradient-border {
            border: 2px solid transparent;
            border-image: linear-gradient(to right, #2c5e3a, #4a8c5c);
            border-image-slice: 1;
        }
        @keyframes pulse {
            0% { transform: scale(1); }
            50% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .animate-pulse-slow {
            animation: pulse 3s infinite;
        }
        @keyframes slideIn {
            0% { transform: translateX(100%); opacity: 0; }
            100% { transform: translateX(0); opacity: 1; }
        }
        .animate-slide-in {
            animation: slideIn 1s ease-in-out;
        }
        .swal-custom-confirm {
            background-color: #28a745 !important; /* Warna hijau */
            color: #fff !important; /* Warna teks putih */
            border: none !important;
            border-radius: 4px !important;
            padding: 10px 20px !important;
            font-size: 16px !important;
            cursor: pointer !important;
            transition: background-color 0.3s ease !important;
        }

        .swal-custom-confirm:hover {
            background-color: #218838 !important; /* Warna hijau gelap saat hover */
        }
  </style>
 </head>
 <body class="min-h-screen flex flex-col">
  <!-- Navigation -->
  <nav class="bg-white shadow-md py-4">
   <div class="container mx-auto px-4 flex justify-between items-center">
    <div class="flex items-center space-x-3">
     <img alt="ParuAI Logo" class="h-10 w-10" height="40" src="https://github.com/user-attachments/assets/fd4904ce-9687-47b6-9b51-91b92b2ae4a0" width="40"/>
     <h1 class="text-2xl font-bold text-green-800">
      ParuAI
     </h1>
    </div>
    <div class="space-x-10">
      <a class="text-green-700 hover:text-green-500" href="https://github.com/belgisanggita/lung-cancer-prediction">
        <i class="fab fa-github">
        </i>
        Source Code
     </a>
    </div>
   </div>
  </nav>
  <!-- Main Content -->
  <div class="container mx-auto px-4 py-8 flex-grow">
   <div class="grid md:grid-cols-2 gap-8 items-center">
    <!-- Left Side: Information -->
    <div class="space-y-6">
     <h2 class="text-4xl font-bold text-green-900">
      Lung Cancer Detection
     </h2>
     <p class="text-gray-700 leading-relaxed">
      ParuAI adalah platform canggih untuk deteksi dini dan pemahaman kanker paru-paru menggunakan teknologi AI mutakhir.
     </p>
     <!-- Features -->
     <div class="grid grid-cols-3 gap-4">
      <div class="bg-white p-4 rounded-lg shadow-md text-center hover:shadow-xl transition-all">
       <svg class="w-10 h-10 mx-auto text-green-600" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
        </path>
       </svg>
       <h3 class="mt-2 font-semibold text-green-800">
        AI Deep Learning dengan CNN Model
       </h3>
      </div>
      <div class="bg-white p-4 rounded-lg shadow-md text-center hover:shadow-xl transition-all">
       <svg class="w-10 h-10 mx-auto text-green-600" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M8 10h.01M12 10h.01M16 10h.01M9 16H5a2 2 0 01-2-2V6a2 2 0 012-2h14a2 2 0 012 2v8a2 2 0 01-2 2h-5l-5 5v-5z" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
        </path>
       </svg>
       <h3 class="mt-2 font-semibold text-green-800">
        Terintegrasi dengan AI Assistant
       </h3>
      </div>
      <div class="bg-white p-4 rounded-lg shadow-md text-center hover:shadow-xl transition-all">
       <svg class="w-10 h-10 mx-auto text-green-600" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M19.428 15.428a2 2 0 00-1.022-.547l-2.387-.477a6 6 0 01-4.198-3.116l-.865-1.861a2 2 0 00-1.708-1.114l-2.49-.154a2 2 0 01-1.86-2.33l.297-1.587a2 2 0 011.634-1.623l2.31-.346a6 6 0 004.643-3.752l.717-2.07a2 2 0 011.9-1.336h1.252a2 2 0 011.901 1.336l.716 2.07a6 6 0 004.643 3.752l2.311.346a2 2 0 011.633 1.623l.297 1.587a2 2 0 01-1.859 2.33l-2.49.154a2 2 0 00-1.708 1.114l-.866 1.861a6 6 0 01-4.198 3.116l-2.387.477a2 2 0 00-1.022.547m0 0L12 19.5m0 0l1.5-1.5" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
        </path>
       </svg>
       <h3 class="mt-2 font-semibold text-green-800">
        Akurasi Tinggi (99-100%) dan Loss Rendah (3%)
       </h3>
      </div>
     </div>
    </div>
    <!-- Right Side: Upload Area -->
    <div class="bg-white rounded-lg shadow-xl p-6 gradient-border animate-pulse-slow">
     <div class="border-dashed border-2 border-green-300 p-6 rounded-md text-center" id="drop-area">
      <p class="text-green-700 font-semibold">
       Unggah Gambar CT Scan
      </p>
      <input accept=".png, .jpg, .jpeg" class="hidden" id="file-input" type="file"/>
      <div class="mt-4 flex justify-center">
       <svg class="w-16 h-16 text-green-600 animate-bounce" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
        <path d="M12 4v16m8-8H4" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
        </path>
       </svg>
      </div>
      <p class="text-gray-600">
       Seret dan jatuhkan gambar di sini, atau klik untuk memilih
      </p>
     </div>
     <button class="mt-4 bg-green-600 text-white px-4 py-2 rounded hover:bg-green-700 transition-colors" id="upload-button">
      Unggah dan Prediksi
     </button>
    </div>
   </div>
   <!-- Contoh Gambar CT Scan -->
   <div class="col-span-3 mt-6">
       <h3 class="text-2xl font-semibold text-green-900">Contoh Gambar CT Scan</h3>
       <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
           <div class="bg-white p-4 rounded-lg shadow-md text-center hover:shadow-xl transition-all hover:-translate-y-2 hover:scale-105">
               <img src="https://github.com/user-attachments/assets/e044b64a-4e5a-4b73-adc1-429ad8a3e6d6" alt="Normal CT Scan" class="w-full h-48 object-cover rounded-lg mb-2">
               <h4 class="font-semibold text-green-800">Normal</h4><p>Paru-paru tampak sehat, tidak ada tanda-tanda tumor atau abnormalitas.</p>
               <svg class="w-10 h-10 mx-auto text-green-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
               </svg>
           </div>
           <div class="bg-white p-4 rounded-lg shadow-md text-center hover:shadow-xl transition-all hover:-translate-y-2 hover:scale-105">
               <img src="https://github.com/user-attachments/assets/4f9c0654-f22c-4143-a314-b10433dc7df8" alt="Benign CT Scan" class="w-full h-48 object-cover rounded-lg mb-2">
               <h4 class="font-semibold text-green-800">Benign</h4><p>Tumor non-kanker yang tidak menyebar, biasanya tidak mengancam jiwa.</p>
               <svg class="w-10 h-10 mx-auto text-blue-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.828 14.828a4 4 0 01-5.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
               </svg>
           </div>
           <div class="bg-white p-4 rounded-lg shadow-md text-center hover:shadow-xl transition-all hover:-translate-y-2 hover:scale-105">
               <img src="https://github.com/user-attachments/assets/59039c32-163a-442e-9e74-5bb2e6af2bbe" alt="Malignant CT Scan" class="w-full h-48 object-cover rounded-lg mb-2">
               <h4 class="font-semibold text-green-800">Malignant</h4><p>Tumor ganas yang dapat menyebar ke jaringan sekitar dan berbahaya.</p>
               <svg class="w-10 h-10 mx-auto text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                   <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"></path>
               </svg>
           </div>
       </div>
   </div>
  </div>
  
  <!-- Floating Chat Button -->
  <div class="fixed bottom-4 right-4 flex items-center space-x-2">
    <div class="bg-green-600 text-white text-xs px-4 py-2 rounded-full shadow-md focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-opacity-50 animate-slide-in hidden" id="chat-notification">
        Butuh Bantuan? Tanyakan Saja dengan AI ini!
    </div>
    <button class="bg-green-700 text-white p-4 rounded-full hover:bg-green-600 shadow-lg relative" id="chat-button">
        <i class="fas fa-comments text-2xl"></i>
    </button>
  </div>
   
  </div>
  <!-- Chat Dialog -->
  <div class="fixed bottom-24 right-6 w-96 bg-white rounded-lg shadow-xl hidden transition-all duration-500 ease-in-out" id="chat-dialog">
   <div class="p-4 border-b border-gray-200">
    <div class="flex justify-between items-center">
     <img alt="ParuAI Logo" class="h-10 w-10" height="40" src="https://github.com/user-attachments/assets/fd4904ce-9687-47b6-9b51-91b92b2ae4a0" width="40"/></img>
     <h2 class="text-lg font-semibold">
      Chat with ParuAI
     </h2>
     <button class="text-gray-500 hover:text-gray-700" id="close-chat">
      <svg class="h-6 w-6" fill="none" stroke="currentColor" viewbox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
       <path d="M6 18L18 6M6 6l12 12" stroke-linecap="round" stroke-linejoin="round" stroke-width="2">
       </path>
      </svg>
     </button>
    </div>
   </div>
   <div class="p-4 h-96 overflow-y-auto space-y-4" id="chat-messages">
   </div>
   <div class="p-4 border-t border-gray-200">
    <form class="flex space-x-2" id="chat-form">
     <input class="flex-1 px-4 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-green-500" id="chat-input" placeholder="Type your message..." type="text"/>
     <button class="bg-green-500 text-white px-4 py-2 rounded-lg hover:bg-green-600 transition-all duration-300" type="submit">
      Send
     </button>
    </form>
   </div>
  </div>

  <script>
   // File upload handling
        const dropArea = document.getElementById('drop-area');
        const fileInput = document.getElementById('file-input');
        const uploadButton = document.getElementById('upload-button');
        let selectedFile = null;

        // Drag and drop events
        dropArea.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropArea.classList.add('bg-green-100');
        });

        dropArea.addEventListener('dragleave', () => {
            dropArea.classList.remove('bg-green-100');
        });

        dropArea.addEventListener('drop', (e) => {
            e.preventDefault();
            dropArea.classList.remove('bg-green-100');
            selectedFile = e.dataTransfer.files[0];
            showSelectedFile();
        });

        dropArea.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', (e) => {
            selectedFile = e.target.files[0];
            showSelectedFile();
        });

        function showSelectedFile() {
            if (selectedFile) {
                dropArea.innerHTML = `
                    <p class="text-green-700 font-semibold">Unggah Gambar CT Scan</p>
                    <div class="mt-4 flex justify-center">
                        <svg class="w-16 h-16 text-green-600 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path d="M12 4v16m8-8H4" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                        </svg>
                    </div>
                    <p class="text-gray-600">${selectedFile.name}</p>
                `;
            }
        }


        // Upload and predict
        uploadButton.addEventListener('click', async () => {
            if (!selectedFile) {
                Swal.fire({
                    title: 'Maaf!',
                    text: 'Tidak ada gambar yang diupload, tolong input gambar berupa CT Scan Paru-Paru',
                    icon: 'error',
                    confirmButtonText: 'OK',
                    customClass: {
                        confirmButton: 'swal-custom-confirm',
                    },
                });
                return;
            }
        
            // Convert the file to a Base64 string
            const reader = new FileReader();
            reader.onload = async (event) => {
                const base64String = event.target.result.split(',')[1]; // Remove the "data:" prefix
                
                const payload = {
                    file_name: selectedFile.name,
                    file_data: base64String,
                };
        
                try {
                    const response = await fetch('/predict', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify(payload),
                    });
        
                    const data = await response.json();
        
                    if (data.error) {
                        Swal.fire('Error', data.error, 'error');
                    } else {
                        // Show the results
                        await Swal.fire({
                            title: `<b>Prediction Results</b><br>${data.label.toUpperCase()}<br><p class="text-lg font-medium">Confidence Level : ${data.confidence}</p>`,
                            html: `<img src="data:image/png;base64,${data.file_data}"  alt="Uploaded Image" class="rounded mt-4" style="max-width: 100%;">`,
                            icon: 'success',
                            confirmButtonText: 'OK',
                            customClass: {
                                confirmButton: 'swal-custom-confirm',
                            },
                        });
        
                        // Reset the input
                        selectedFile = null;
                        fileInput.value = '';
                        dropArea.innerHTML = `
                            <p class="text-green-700 font-semibold">Unggah Gambar CT Scan</p>
                            <div class="mt-4 flex justify-center">
                                <svg class="w-16 h-16 text-green-600 animate-bounce" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path d="M12 4v16m8-8H4" stroke-linecap="round" stroke-linejoin="round" stroke-width="2"></path>
                                </svg>
                            </div>
                            <p class="text-gray-600">Seret dan jatuhkan gambar di sini, atau klik untuk memilih</p>
                        `;
                    }
                } catch (error) {
                    Swal.fire('Error', 'An error occurred during prediction.', 'error');
                    console.error('Prediction error:', error);
                }
            };
        
            reader.readAsDataURL(selectedFile);
        });

        // Chat functionality
        const chatButton = document.getElementById('chat-button');
        const chatDialog = document.getElementById('chat-dialog');
        const closeChat = document.getElementById('close-chat');
        const chatForm = document.getElementById('chat-form');
        const chatInput = document.getElementById('chat-input');
        const chatMessages = document.getElementById('chat-messages');
        const chatNotification = document.getElementById('chat-notification');

        // Chat dialog toggle
        chatButton.addEventListener('click', () => {
            chatDialog.classList.toggle('hidden');
            if (!chatDialog.classList.contains('hidden')) {
                chatInput.focus();
            }
        });

        closeChat.addEventListener('click', () => {
            chatDialog.classList.add('hidden');
        });

        // Function to add message to chat
        function addMessage(content, isUser = false) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `flex ${isUser ? 'justify-end' : 'justify-start'}`;
            
            const messageContent = document.createElement('div');
            messageContent.className = `max-w-[75%] rounded-lg p-3 ${
                isUser ? 'bg-green-500 text-white' : 'bg-gray-100 text-gray-800'
            }`;
            messageContent.style.whiteSpace = 'pre-wrap';
            messageContent.textContent = content;
            
            messageDiv.appendChild(messageContent);
            chatMessages.appendChild(messageDiv);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        // Handle chat form submission
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = chatInput.value.trim();
            if (!message) return;

            // Clear input and add user message
            chatInput.value = '';
            addMessage(message, true);

            try {
                const response = await fetch('/chat', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                    },
                    body: JSON.stringify({ message }),
                });

                const data = await response.json();
                if (data.error) {
                    throw new Error(data.error);
                }

                // Add AI response
                addMessage(data.response);
            } catch (error) {
                addMessage('Sorry, an error occurred. Please try again.');
                console.error('Chat error:', error);
            }
        });

        // Show chat notification
        function showChatNotification() {
            chatNotification.classList.remove('hidden');
            setTimeout(() => {
                chatNotification.classList.add('hidden');
            }, 10000);
        }

        // Show notification every 10 seconds
        setInterval(showChatNotification, 15000);

        // Initial notification display
        showChatNotification();
  </script>
 </body>
</html>
